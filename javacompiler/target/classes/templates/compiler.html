<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Java Compiler</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa; /* LeetCode background color */
            color: #333;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #app-bar {
            background-color: #343a40;  
            color: #fff;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #app-bar p {
            margin: 0;
        }

        h1 {
            margin: 0;
        }

        .container {
            display: flex;
            height: 75vh;
            overflow: hidden;
            position: relative;
        }

        #question-container,
        #code-container {
            flex-grow: 1;
            overflow: auto;
            box-sizing: border-box;
            padding: 20px;
            height: 100%;
            width: 50%;
        }

        .draggable-bar {
            width: 10px;
            cursor: ew-resize;
            background-color: #ddd;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -5px;
            z-index: 1;
        }

        .code-textarea {
            width: 100%;
            height: 400px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 0;
            padding: 10px;
            color: #333;
            overflow: auto;
            resize: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .passed {
            background-color: #d4edda;  
        }

        .failed {
            background-color: #f8d7da;  
        }

        .tick, .cross {
            font-size: 18px;
            margin-right: 5px;
        }

        #compile-button-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 10px;
            margin-right: 20px;
        }

        #compile-button-container form {
            margin-right: 10px;
        }

        #compile-button-container input[type="submit"],
        #compile-button-container input[type="button"],
        #compile-button-container button {
            width: auto;
            padding: 8px 15px;
            margin: 0 5px;
        }
              
    </style>
</head>
 
<body>
     
   <!-- Timer and Registration Number -->
    <div id="app-bar">
        <div id="timer-info">
            <p>Timer: <span id="timer" th:text="${timers}"></span></p>
        </div>
        <div id="registration-info">
            <p>Registration Number: <span th:text="${reg_no}"></span></p>
        </div>
    </div>

    <!-- Compiler Container -->
    <div class="container"  >
        <!-- Question Container -->
        <div id="question-container">
            <h2>Question:</h2>
            <p th:text="${question.ques}"></p>
        </div>

        <div class="draggable-bar" id="draggable-bar"></div>

        <!-- Code Container -->
        <div id="code-container" >
            <form id="compileForm" method="post" th:object="${code}" onsubmit="return validateCode();">
                <input type="hidden" name="questionId" th:value="${question.id}" />
                <textarea id="sourceCode" name="sourceCode" th:field="${code.sourceCode}" class="code-textarea" placeholder="Enter Java code" required></textarea>
                <input type="hidden" name="questionId" th:value="${question.id}" />
                 <input type="hidden" name="timer" th:value="${timers}" />
                 <input type="hidden" name="reg_no" th:value="${reg_no}" />
                <!-- First Button (Compile and Run) -->
                <input type="submit" value="Compile and Run" style="display: none;" id="compileAndRunBtn" formaction="/compile">

                <!-- Second Button (Another Button) -->
                <input type="submit" value="Another Button" style="display: none;" id="anotherBtn" formaction="/tester">
                <!-- Third Button (Another Button) -->
                <input type="submit" value="Submit" style="display: none;" id="sBtn" formaction="/submit">
            </form>
        </div>
    </div>

    <!-- Compile Button Container -->
    <div id="compile-button-container">
        <button type="button" onclick="submitForm()">Compile</button>
        <button type="button" onclick="TestsubmitForm()">Run Test</button>
        <button type="button" onclick="ssubmitForm()">Submit</button>
    </div>

 <!-- Display Open Test Cases Compilation Results -->
    <h2>Open Test Cases:</h2>
    <table th:if="${openCompilationResult != null}">
        <tr>
            <th>Test Case</th>
            <th>Expected Output</th>
            <th>Actual Output</th>
            <th>Status</th>
        </tr>
        <tr th:each="testCaseResult, index : ${openCompilationResult.outputResults}">
            <td th:text="${testCaseResult.input}"></td>
            <td th:text="${testCaseResult.expectedOutput}"></td>
            <td th:text="${testCaseResult.actualOutput}"></td>
            <td th:class="${testCaseResult.testCasePassed ? 'passed' : 'failed'}">
                <span th:if="${testCaseResult.testCasePassed}" class="tick">&#10004;</span>
                <span th:unless="${testCaseResult.testCasePassed}" class="cross">&#10008;</span>
            </td>
        </tr>
    </table>
    <!-- Display Closed Test Cases Compilation Results -->
    <h2>Closed Test Cases:</h2>
    <div th:if="${closedCompilationResult != null}" style="display: flex;">
        <div th:each="testCaseResult, index : ${closedCompilationResult.outputResults}" style="margin-right: 10px;">
            <p th:style="${testCaseResult.testCasePassed} ? 'color: green;' : 'color: red;'">
                Test Case <span th:text="${index.index + 1}"></span>:
                <span th:if="${testCaseResult.testCasePassed}" class="tick">&#10004;</span>
                <span th:unless="${testCaseResult.testCasePassed}" class="cross">&#10008;</span>
            </p>
        </div>
    </div>
 
<script>
    document.addEventListener('DOMContentLoaded', function () {
    	openFullscreen();
    	var timerElement = document.getElementById('timer');
        var timerValue = timerElement.textContent.trim(); // Get the text content of the timer element
        var duration = parseInt(timerValue); // Convert to integer
        var display = document.querySelector('#timer');
        if (!isNaN(duration)) { // Check if duration is a valid number
            startTimer(duration, display);
        } else {
            console.error("Invalid timer duration:", timerValue);
        }

        // Initialize draggable bar functionality
        const draggableBar = document.getElementById('draggable-bar');
        const questionContainer = document.getElementById('question-container');
        const codeContainer = document.getElementById('code-container');
        const container = document.querySelector('.container');

        let isDragging = false;

        draggableBar.addEventListener('mousedown', function (event) {
            isDragging = true;
        });

        document.addEventListener('mousemove', function (event) {
            if (isDragging) {
                const containerRect = container.getBoundingClientRect();
                const mouseX = event.clientX;

                const questionWidth = mouseX - containerRect.left;
                const codeWidth = containerRect.width - mouseX;

                questionContainer.style.width = `${questionWidth}px`;
                codeContainer.style.width = `${codeWidth}px`;

                draggableBar.style.left = `${mouseX - containerRect.left - 5}px`;
            }
        });

        document.addEventListener('mouseup', function () {
            isDragging = false;
        });
    });

    // Function to start the timer
    function startTimer(duration, display) {
        var timer = duration * 60; // Convert minutes to seconds

        // Update the timer display initially
        updateDisplay(timer, display);

        // Update the timer display every second
        var interval = setInterval(function () {
            if (timer <= 0) {
                clearInterval(interval);
                // Optionally, you can add logic here when the timer reaches zero
            } else {
                timer -= 1; // Decrease timer by 1 second
                updateDisplay(timer, display); // Update display
            }
        }, 1000); // Update every second
    }

    // Function to update timer display
    function updateDisplay(timer, display) {
        var minutes = Math.floor(timer / 60);
        var seconds = timer % 60;

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;
    }

    function submitForm(event) {
    	
    	document.getElementById("compileAndRunBtn").click();
    	 
    }

    function TestsubmitForm(event) {
    	 
        document.getElementById("anotherBtn").click();
         
    }

    function ssubmitForm(event) {
    	 
        document.getElementById("sBtn").click();
        
         
    }

    // Function to make the document full-screen
    function openFullscreen() {
            const element = document.documentElement;
            if (element.requestFullscreen) {
                element.requestFullscreen();
            } else if (element.mozRequestFullScreen) { /* Firefox */
                element.mozRequestFullScreen();
            } else if (element.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) { /* IE/Edge */
                element.msRequestFullscreen();
            }
        }

    // Open full-screen mode when the document loads
   // document.addEventListener('DOMContentLoaded', function () {
   //     openFullscreen();
    // });

    // Prevent history manipulation
    history.pushState(null, null, location.href);
    window.onpopstate = function () {
        history.pushState(null, null, location.href);
    };
</script>

</body>
</html>
